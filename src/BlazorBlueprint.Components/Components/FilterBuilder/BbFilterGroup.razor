@namespace BlazorBlueprint.Components

<div class="@GroupCssClass" role="group" aria-label="@GroupAriaLabel">
    @* Group header: operator toggle + remove button *@
    <div class="@HeaderCssClass">
        <div class="flex items-center gap-2">
            @if (IsRoot)
            {
                <span class="text-xs font-medium text-muted-foreground uppercase tracking-wider">Where</span>
            }
            <BbSelect TValue="LogicalOperator"
                      Value="@Group.Operator"
                      ValueChanged="HandleOperatorChanged"
                      Options="@logicalOperatorOptions"
                      Class="w-[80px]" />
        </div>
        @if (!IsRoot)
        {
            <BbButton Variant="ButtonVariant.Ghost"
                      Size="ButtonSize.IconSmall"
                      OnClick="HandleRemoveGroup"
                      Class="shrink-0 text-muted-foreground hover:text-destructive"
                      aria-label="Remove group">
                <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18" />
                    <line x1="6" y1="6" x2="18" y2="18" />
                </svg>
            </BbButton>
        }
    </div>

    @* Conditions *@
    <div class="@ConditionsCssClass">
        @foreach (var condition in Group.Conditions)
        {
            <BbFilterCondition Condition="@condition"
                               OnRemove="@(() => RemoveCondition(condition))"
                               OnChanged="HandleChanged" />
        }

        @* Nested groups *@
        @foreach (var nestedGroup in Group.Groups)
        {
            <BbFilterGroup Group="@nestedGroup"
                           Depth="@(Depth + 1)"
                           IsRoot="false"
                           OnRemove="@(() => RemoveGroup(nestedGroup))" />
        }
    </div>

    @* Action buttons *@
    <div class="flex items-center gap-2">
        <BbButton Variant="ButtonVariant.Ghost"
                  Size="ButtonSize.Small"
                  OnClick="AddCondition"
                  Disabled="@(Context?.IsAtConditionLimit == true)"
                  Class="text-muted-foreground hover:text-foreground">
            <svg class="h-4 w-4 me-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19" />
                <line x1="5" y1="12" x2="19" y2="12" />
            </svg>
            Add condition
        </BbButton>

        @if (Context != null && Depth < Context.MaxDepth)
        {
            <BbButton Variant="ButtonVariant.Ghost"
                      Size="ButtonSize.Small"
                      OnClick="AddGroup"
                      Disabled="@(Context.IsAtConditionLimit)"
                      Class="text-muted-foreground hover:text-foreground">
                <svg class="h-4 w-4 me-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="12" y1="5" x2="12" y2="19" />
                    <line x1="5" y1="12" x2="19" y2="12" />
                </svg>
                Add group
            </BbButton>
        }
    </div>
</div>
