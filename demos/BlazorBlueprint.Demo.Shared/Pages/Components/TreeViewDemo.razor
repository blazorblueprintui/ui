@page "/components/tree-view"

<PageTitle>Tree View Component - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-4xl">
    <div>
        <div class="space-y-3">
            <h1 class="text-4xl font-bold tracking-tight">Tree View Component</h1>
            <p class="text-xl text-muted-foreground">
                A hierarchical data display for file explorers, category browsers, navigation trees, and more.
            </p>
        </div>
    </div>

    <div class="space-y-6">

        @* --- 1. Basic Tree --- *@
        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">Basic Tree</h2>
                <p class="text-muted-foreground">
                    A simple declarative tree with expand/collapse. Click nodes to expand or collapse branches.
                </p>
            </div>

            <div class="rounded-lg border p-4">
                <BbTreeView TItem="object" SelectionMode="TreeSelectionMode.None">
                    <BbTreeItem Value="docs" Label="Documents" Icon="folder">
                        <BbTreeItem Value="reports" Label="Reports" Icon="folder">
                            <BbTreeItem Value="q1" Label="Q1 Report.pdf" Icon="file-text" />
                            <BbTreeItem Value="q2" Label="Q2 Report.pdf" Icon="file-text" />
                        </BbTreeItem>
                        <BbTreeItem Value="invoices" Label="Invoices" Icon="folder">
                            <BbTreeItem Value="inv1" Label="Invoice #1001.pdf" Icon="file-text" />
                            <BbTreeItem Value="inv2" Label="Invoice #1002.pdf" Icon="file-text" />
                        </BbTreeItem>
                    </BbTreeItem>
                    <BbTreeItem Value="images" Label="Images" Icon="folder">
                        <BbTreeItem Value="logo" Label="logo.png" Icon="image" />
                        <BbTreeItem Value="banner" Label="banner.jpg" Icon="image" />
                    </BbTreeItem>
                    <BbTreeItem Value="readme" Label="README.md" Icon="file" />
                </BbTreeView>
            </div>
            <CodeBlock Source="Components/TreeView/basic.txt" />
        </section>

        @* --- 2. Data-Driven Tree (Nested Data) --- *@
        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">Data-Driven (Nested Data)</h2>
                <p class="text-muted-foreground">
                    Tree generated from nested object data using <code>ChildrenProperty</code>.
                </p>
            </div>

            <div class="rounded-lg border p-4">
                <BbTreeView TItem="CategoryNode"
                            Items="@nestedCategories"
                            ChildrenProperty="@(c => c.Children)"
                            TextField="@(c => c.Name)"
                            ValueField="@(c => c.Id)"
                            IconField="@(c => c.Icon)"
                            SelectionMode="TreeSelectionMode.Single"
                            @bind-SelectedValue="selectedCategory"
                            DefaultExpandDepth="1" />
            </div>
            <p class="text-sm text-muted-foreground">
                Selected: <strong>@(selectedCategory ?? "None")</strong>
            </p>
            <CodeBlock Source="Components/TreeView/data-driven.txt" />
        </section>

        @* --- 3. Flat Data with Parent References --- *@
        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">Flat Data (Parent References)</h2>
                <p class="text-muted-foreground">
                    Tree built from flat data using <code>ParentField</code> to reference parent IDs.
                </p>
            </div>

            <div class="rounded-lg border p-4">
                <BbTreeView TItem="FlatNode"
                            Items="@flatNodes"
                            ParentField="@(n => n.ParentId)"
                            TextField="@(n => n.Name)"
                            ValueField="@(n => n.Id)"
                            SelectionMode="TreeSelectionMode.Multiple"
                            @bind-SelectedValues="selectedFlatIds"
                            DefaultExpandAll="true" />
            </div>
            <p class="text-sm text-muted-foreground">
                Selected: <strong>@(selectedFlatIds.Count > 0 ? string.Join(", ", selectedFlatIds) : "None")</strong>
            </p>
            <CodeBlock Source="Components/TreeView/flat-data.txt" />
        </section>

        @* --- 4. Single and Multi-Selection --- *@
        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">Selection Modes</h2>
                <p class="text-muted-foreground">
                    Single selection: only one node can be selected. Multiple selection: toggle multiple nodes.
                </p>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="rounded-lg border p-4">
                    <p class="text-sm font-medium mb-2">Single Selection</p>
                    <BbTreeView TItem="object" SelectionMode="TreeSelectionMode.Single" @bind-SelectedValue="singleSelectedValue">
                        <BbTreeItem Value="fruits" Label="Fruits" Icon="apple">
                            <BbTreeItem Value="apple" Label="Apple" />
                            <BbTreeItem Value="banana" Label="Banana" />
                            <BbTreeItem Value="cherry" Label="Cherry" />
                        </BbTreeItem>
                        <BbTreeItem Value="vegetables" Label="Vegetables" Icon="salad">
                            <BbTreeItem Value="carrot" Label="Carrot" />
                            <BbTreeItem Value="broccoli" Label="Broccoli" />
                        </BbTreeItem>
                    </BbTreeView>
                    <p class="text-xs text-muted-foreground mt-2">Selected: @(singleSelectedValue ?? "None")</p>
                </div>

                <div class="rounded-lg border p-4">
                    <p class="text-sm font-medium mb-2">Multiple Selection</p>
                    <BbTreeView TItem="object" SelectionMode="TreeSelectionMode.Multiple" @bind-SelectedValues="multiSelectedValues">
                        <BbTreeItem Value="red" Label="Red" />
                        <BbTreeItem Value="green" Label="Green" />
                        <BbTreeItem Value="blue" Label="Blue" />
                        <BbTreeItem Value="yellow" Label="Yellow" />
                        <BbTreeItem Value="purple" Label="Purple" />
                    </BbTreeView>
                    <p class="text-xs text-muted-foreground mt-2">Selected: @(multiSelectedValues.Count > 0 ? string.Join(", ", multiSelectedValues) : "None")</p>
                </div>
            </div>
            <CodeBlock Source="Components/TreeView/selection.txt" />
        </section>

        @* --- 5. Checkable Tree with Cascade --- *@
        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">Checkable Tree</h2>
                <p class="text-muted-foreground">
                    Tri-state checkboxes with parent/child cascade. Checking a parent checks all descendants.
                    Checking some children puts the parent in indeterminate state.
                </p>
            </div>

            <div class="rounded-lg border p-4">
                <BbTreeView TItem="object" Checkable="true" @bind-CheckedValues="checkedPermissions" DefaultExpandAll="true">
                    <BbTreeItem Value="admin" Label="Administration" Icon="shield">
                        <BbTreeItem Value="users" Label="User Management" Icon="users">
                            <BbTreeItem Value="user-create" Label="Create Users" />
                            <BbTreeItem Value="user-edit" Label="Edit Users" />
                            <BbTreeItem Value="user-delete" Label="Delete Users" />
                        </BbTreeItem>
                        <BbTreeItem Value="settings" Label="Settings" Icon="settings">
                            <BbTreeItem Value="settings-general" Label="General Settings" />
                            <BbTreeItem Value="settings-security" Label="Security Settings" />
                        </BbTreeItem>
                    </BbTreeItem>
                    <BbTreeItem Value="content" Label="Content" Icon="file-text">
                        <BbTreeItem Value="content-create" Label="Create Content" />
                        <BbTreeItem Value="content-edit" Label="Edit Content" />
                        <BbTreeItem Value="content-publish" Label="Publish Content" />
                    </BbTreeItem>
                </BbTreeView>
            </div>
            <p class="text-sm text-muted-foreground">
                Checked: <strong>@(checkedPermissions.Count > 0 ? string.Join(", ", checkedPermissions) : "None")</strong>
            </p>
            <CodeBlock Source="Components/TreeView/checkable.txt" />
        </section>

        @* --- 6. Lazy Loading --- *@
        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">Lazy Loading</h2>
                <p class="text-muted-foreground">
                    Children are loaded on demand when a node is expanded for the first time.
                    A loading spinner appears during fetch, and results are cached.
                </p>
            </div>

            <div class="rounded-lg border p-4">
                <BbTreeView TItem="LazyNode"
                            Items="@lazyRootNodes"
                            TextField="@(n => n.Name)"
                            ValueField="@(n => n.Id)"
                            IconField="@(n => n.Icon)"
                            HasChildrenField="@(n => n.HasChildren)"
                            OnLoadChildren="LoadLazyChildren"
                            SelectionMode="TreeSelectionMode.Single"
                            @bind-SelectedValue="selectedLazyNode" />
            </div>
            <CodeBlock Source="Components/TreeView/lazy-loading.txt" />
        </section>

        @* --- 7. Drag and Drop --- *@
        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">Drag and Drop</h2>
                <p class="text-muted-foreground">
                    Drag nodes to reorder or reparent within the tree. Drop indicators show
                    where the node will be placed (before, after, or inside a target node).
                </p>
            </div>

            <div class="rounded-lg border p-4">
                <BbTreeView TItem="DragNode"
                            Items="@dragItems"
                            ChildrenProperty="@(n => n.Children)"
                            TextField="@(n => n.Name)"
                            ValueField="@(n => n.Id)"
                            IconField="@(n => n.Icon)"
                            Draggable="true"
                            OnNodeDrop="HandleDrop"
                            DefaultExpandAll="true"
                            SelectionMode="TreeSelectionMode.Single" />
            </div>
            <p class="text-sm text-muted-foreground">@dragMessage</p>
            <CodeBlock Source="Components/TreeView/drag-drop.txt" />
        </section>

        @* --- 8. Search and Filter --- *@
        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">Search and Filter</h2>
                <p class="text-muted-foreground">
                    Built-in search input filters visible nodes and auto-expands matching branches.
                    Matching text is highlighted.
                </p>
            </div>

            <div class="rounded-lg border p-4">
                <BbTreeView TItem="CategoryNode"
                            Items="@nestedCategories"
                            ChildrenProperty="@(c => c.Children)"
                            TextField="@(c => c.Name)"
                            ValueField="@(c => c.Id)"
                            IconField="@(c => c.Icon)"
                            ShowSearch="true"
                            SearchPlaceholder="Search categories..."
                            SelectionMode="TreeSelectionMode.Single"
                            DefaultExpandDepth="1" />
            </div>
            <CodeBlock Source="Components/TreeView/search.txt" />
        </section>

        @* --- 9. Custom Node Templates --- *@
        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">Custom Node Templates</h2>
                <p class="text-muted-foreground">
                    Nodes with custom label templates and action buttons that appear on hover.
                </p>
            </div>

            <div class="rounded-lg border p-4">
                <BbTreeView TItem="object" SelectionMode="TreeSelectionMode.Single">
                    <BbTreeItem Value="project" Label="My Project" Icon="folder">
                        <BbTreeItem Value="src" Icon="folder">
                            <LabelTemplate>
                                <span class="font-medium">src</span>
                                <span class="text-xs text-muted-foreground ml-1">(source code)</span>
                            </LabelTemplate>
                            <ActionsTemplate>
                                <BbButton Variant="ButtonVariant.Ghost" Size="ButtonSize.Icon" Class="h-6 w-6">
                                    <LucideIcon Name="plus" Size="14" />
                                </BbButton>
                            </ActionsTemplate>
                            <ChildContent>
                                <BbTreeItem Value="app.cs" Label="App.cs" Icon="file-code" />
                                <BbTreeItem Value="program.cs" Label="Program.cs" Icon="file-code" />
                            </ChildContent>
                        </BbTreeItem>
                        <BbTreeItem Value="tests" Icon="folder">
                            <LabelTemplate>
                                <span class="font-medium">tests</span>
                                <BbBadge Variant="BadgeVariant.Outline" Class="ml-1 text-xs px-1 py-0 h-4">2 files</BbBadge>
                            </LabelTemplate>
                            <ChildContent>
                                <BbTreeItem Value="test1.cs" Label="AppTests.cs" Icon="file-code" />
                                <BbTreeItem Value="test2.cs" Label="UtilTests.cs" Icon="file-code" />
                            </ChildContent>
                        </BbTreeItem>
                    </BbTreeItem>
                </BbTreeView>
            </div>
            <CodeBlock Source="Components/TreeView/custom-templates.txt" />
        </section>

        @* --- 10. Icons and Badges --- *@
        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">Icons and Badges</h2>
                <p class="text-muted-foreground">
                    Nodes with Lucide icons and count badges.
                </p>
            </div>

            <div class="rounded-lg border p-4">
                <BbTreeView TItem="object" SelectionMode="TreeSelectionMode.Single">
                    <BbTreeItem Value="inbox" Label="Inbox" Icon="inbox" Badge="12">
                        <BbTreeItem Value="primary" Label="Primary" Icon="mail" Badge="8" />
                        <BbTreeItem Value="social" Label="Social" Icon="users" Badge="3" />
                        <BbTreeItem Value="promotions" Label="Promotions" Icon="tag" Badge="1" />
                    </BbTreeItem>
                    <BbTreeItem Value="sent" Label="Sent" Icon="send" />
                    <BbTreeItem Value="drafts" Label="Drafts" Icon="file-pen" Badge="2" />
                    <BbTreeItem Value="trash" Label="Trash" Icon="trash-2" />
                </BbTreeView>
            </div>
            <CodeBlock Source="Components/TreeView/icons-badges.txt" />
        </section>

        @* --- 11. Controlled Tree --- *@
        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">Controlled Tree</h2>
                <p class="text-muted-foreground">
                    External state management for expand/collapse. Use buttons to control the tree programmatically.
                </p>
            </div>

            <div class="flex gap-2 mb-2">
                <BbButton Size="ButtonSize.Small" OnClick="ExpandAllControlled">Expand All</BbButton>
                <BbButton Size="ButtonSize.Small" Variant="ButtonVariant.Outline" OnClick="CollapseAllControlled">Collapse All</BbButton>
            </div>

            <div class="rounded-lg border p-4">
                <BbTreeView TItem="object" @bind-ExpandedValues="controlledExpandedValues" SelectionMode="TreeSelectionMode.Single">
                    <BbTreeItem Value="c-root" Label="Root" Icon="folder">
                        <BbTreeItem Value="c-branch1" Label="Branch 1" Icon="folder">
                            <BbTreeItem Value="c-leaf1" Label="Leaf 1" Icon="file" />
                            <BbTreeItem Value="c-leaf2" Label="Leaf 2" Icon="file" />
                        </BbTreeItem>
                        <BbTreeItem Value="c-branch2" Label="Branch 2" Icon="folder">
                            <BbTreeItem Value="c-leaf3" Label="Leaf 3" Icon="file" />
                        </BbTreeItem>
                    </BbTreeItem>
                </BbTreeView>
            </div>
            <CodeBlock Source="Components/TreeView/controlled.txt" />
        </section>

        @* --- 12. Expand on Click --- *@
        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">Expand on Click</h2>
                <p class="text-muted-foreground">
                    With <code>ExpandOnClick</code>, clicking anywhere on a parent node toggles its
                    expanded state â€” no need to click the chevron. Compare the two trees below.
                </p>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="rounded-lg border p-4">
                    <p class="text-sm font-medium mb-2">Default (chevron only)</p>
                    <BbTreeView TItem="object" SelectionMode="TreeSelectionMode.Single">
                        <BbTreeItem Value="eoc-music" Label="Music" Icon="music">
                            <BbTreeItem Value="eoc-rock" Label="Rock" Icon="disc">
                                <BbTreeItem Value="eoc-classic-rock" Label="Classic Rock" />
                                <BbTreeItem Value="eoc-alt-rock" Label="Alternative" />
                            </BbTreeItem>
                            <BbTreeItem Value="eoc-jazz" Label="Jazz" Icon="disc" />
                            <BbTreeItem Value="eoc-electronic" Label="Electronic" Icon="disc" />
                        </BbTreeItem>
                        <BbTreeItem Value="eoc-podcasts" Label="Podcasts" Icon="podcast">
                            <BbTreeItem Value="eoc-tech" Label="Technology" />
                            <BbTreeItem Value="eoc-science" Label="Science" />
                        </BbTreeItem>
                    </BbTreeView>
                </div>

                <div class="rounded-lg border p-4">
                    <p class="text-sm font-medium mb-2">ExpandOnClick enabled</p>
                    <BbTreeView TItem="object" SelectionMode="TreeSelectionMode.Single" ExpandOnClick="true">
                        <BbTreeItem Value="eoc2-music" Label="Music" Icon="music">
                            <BbTreeItem Value="eoc2-rock" Label="Rock" Icon="disc">
                                <BbTreeItem Value="eoc2-classic-rock" Label="Classic Rock" />
                                <BbTreeItem Value="eoc2-alt-rock" Label="Alternative" />
                            </BbTreeItem>
                            <BbTreeItem Value="eoc2-jazz" Label="Jazz" Icon="disc" />
                            <BbTreeItem Value="eoc2-electronic" Label="Electronic" Icon="disc" />
                        </BbTreeItem>
                        <BbTreeItem Value="eoc2-podcasts" Label="Podcasts" Icon="podcast">
                            <BbTreeItem Value="eoc2-tech" Label="Technology" />
                            <BbTreeItem Value="eoc2-science" Label="Science" />
                        </BbTreeItem>
                    </BbTreeView>
                </div>
            </div>
            <CodeBlock Source="Components/TreeView/expand-on-click.txt" />
        </section>

        @* --- 13. Custom Styling --- *@
        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">Custom Styling</h2>
                <p class="text-muted-foreground">
                    Use the <code>Class</code> parameter on <code>BbTreeItem</code> to apply custom styles per node,
                    and the tree-level <code>Class</code> parameter for container styling.
                </p>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="rounded-lg border p-4">
                    <p class="text-sm font-medium mb-2">Status-colored nodes</p>
                    <BbTreeView TItem="object" SelectionMode="TreeSelectionMode.Single" DefaultExpandAll="true">
                        <BbTreeItem Value="cs-pipeline" Label="Deploy Pipeline" Icon="git-branch">
                            <BbTreeItem Value="cs-build" Label="Build" Icon="hammer" Class="text-green-600 dark:text-green-400" />
                            <BbTreeItem Value="cs-test" Label="Test" Icon="test-tubes" Class="text-green-600 dark:text-green-400" />
                            <BbTreeItem Value="cs-lint" Label="Lint" Icon="search-check" Class="text-yellow-600 dark:text-yellow-400" />
                            <BbTreeItem Value="cs-deploy" Label="Deploy" Icon="rocket" Class="text-red-600 dark:text-red-400" />
                        </BbTreeItem>
                    </BbTreeView>
                </div>

                <div class="rounded-lg border p-4">
                    <p class="text-sm font-medium mb-2">Compact with custom container</p>
                    <BbTreeView TItem="object"
                                SelectionMode="TreeSelectionMode.Single"
                                DefaultExpandAll="true"
                                Class="text-xs bg-muted/30 rounded-md p-2"
                                ShowIcons="false">
                        <BbTreeItem Value="cs2-app" Label="app/">
                            <BbTreeItem Value="cs2-layout" Label="layout.tsx" />
                            <BbTreeItem Value="cs2-page" Label="page.tsx" />
                            <BbTreeItem Value="cs2-api" Label="api/">
                                <BbTreeItem Value="cs2-route" Label="route.ts" />
                            </BbTreeItem>
                        </BbTreeItem>
                        <BbTreeItem Value="cs2-public" Label="public/">
                            <BbTreeItem Value="cs2-favicon" Label="favicon.ico" />
                        </BbTreeItem>
                        <BbTreeItem Value="cs2-package" Label="package.json" />
                    </BbTreeView>
                </div>
            </div>
            <CodeBlock Source="Components/TreeView/custom-styling.txt" />
        </section>

        @* --- 14. File Explorer Example --- *@
        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">File Explorer</h2>
                <p class="text-muted-foreground">
                    A comprehensive file explorer combining selection, icons, badges, and search.
                </p>
            </div>

            <div class="rounded-lg border p-4">
                <BbTreeView TItem="CategoryNode"
                            Items="@fileExplorerData"
                            ChildrenProperty="@(n => n.Children)"
                            TextField="@(n => n.Name)"
                            ValueField="@(n => n.Id)"
                            IconField="@(n => n.Icon)"
                            ShowSearch="true"
                            SearchPlaceholder="Search files..."
                            SelectionMode="TreeSelectionMode.Single"
                            @bind-SelectedValue="selectedFile"
                            DefaultExpandDepth="2"
                            ShowLines="true" />
            </div>
            <p class="text-sm text-muted-foreground">
                Selected file: <strong>@(selectedFile ?? "None")</strong>
            </p>
            <CodeBlock Source="Components/TreeView/file-explorer.txt" />
        </section>

        @* --- Accessibility --- *@
        <AccessibilityList>
            <AriaAttributes>
                <AccessibilityItem>Uses <code>role="tree"</code> on the root container and <code>role="treeitem"</code> on each node</AccessibilityItem>
                <AccessibilityItem>Includes <code>aria-expanded</code> on parent nodes to indicate expand/collapse state</AccessibilityItem>
                <AccessibilityItem>Includes <code>aria-selected</code> on nodes when selection is enabled</AccessibilityItem>
                <AccessibilityItem>Includes <code>aria-checked</code> and <code>aria-readonly</code> on checkable nodes</AccessibilityItem>
                <AccessibilityItem>Uses <code>aria-level</code>, <code>aria-setsize</code>, and <code>aria-posinset</code> for tree structure</AccessibilityItem>
                <AccessibilityItem>Supports <code>aria-label</code> on the tree root for screen readers</AccessibilityItem>
                <AccessibilityItem>Disabled nodes include <code>aria-disabled="true"</code></AccessibilityItem>
            </AriaAttributes>
            <KeyboardNavigation>
                <KeyboardShortcutItem Description="Move focus to the next visible node">
                    <BbKbd>ArrowDown</BbKbd>
                </KeyboardShortcutItem>
                <KeyboardShortcutItem Description="Move focus to the previous visible node">
                    <BbKbd>ArrowUp</BbKbd>
                </KeyboardShortcutItem>
                <KeyboardShortcutItem Description="Expand the focused node (or move to first child if already expanded)">
                    <BbKbd>ArrowRight</BbKbd>
                </KeyboardShortcutItem>
                <KeyboardShortcutItem Description="Collapse the focused node (or move to parent if already collapsed)">
                    <BbKbd>ArrowLeft</BbKbd>
                </KeyboardShortcutItem>
                <KeyboardShortcutItem Description="Move focus to the first node in the tree">
                    <BbKbd>Home</BbKbd>
                </KeyboardShortcutItem>
                <KeyboardShortcutItem Description="Move focus to the last visible node in the tree">
                    <BbKbd>End</BbKbd>
                </KeyboardShortcutItem>
                <KeyboardShortcutItem Description="Select the focused node or toggle its checkbox">
                    <BbKbd>Enter</BbKbd> / <BbKbd>Space</BbKbd>
                </KeyboardShortcutItem>
                <KeyboardShortcutItem Description="Expand all siblings at the current level">
                    <BbKbd>*</BbKbd>
                </KeyboardShortcutItem>
            </KeyboardNavigation>
        </AccessibilityList>

        @* --- API Reference --- *@
        <section class="space-y-4">
            <div class="space-y-2">
                <h2 class="text-2xl font-semibold">API Reference</h2>
                <p class="text-muted-foreground">Component properties and parameters.</p>
            </div>
            <div class="space-y-4">
                <ApiReference ComponentName="BbTreeView&lt;TItem&gt;">
                    <ApiParameter Name="Items" Type="IEnumerable&lt;TItem&gt;?" Default="null">
                        Data source for data-driven mode. When provided, nodes are rendered from the data.
                    </ApiParameter>
                    <ApiParameter Name="ChildrenProperty" Type="Func&lt;TItem, IEnumerable&lt;TItem&gt;?&gt;?" Default="null">
                        Function to get child items from a parent item (nested data mode).
                    </ApiParameter>
                    <ApiParameter Name="ParentField" Type="Func&lt;TItem, string?&gt;?" Default="null">
                        Function to get the parent ID from an item (flat data mode).
                    </ApiParameter>
                    <ApiParameter Name="TextField" Type="Func&lt;TItem, string&gt;?" Default="null">
                        Function to get display text from an item.
                    </ApiParameter>
                    <ApiParameter Name="ValueField" Type="Func&lt;TItem, string&gt;?" Default="null">
                        Function to get the unique value/ID from an item.
                    </ApiParameter>
                    <ApiParameter Name="IconField" Type="Func&lt;TItem, string?&gt;?" Default="null">
                        Function to get a Lucide icon name from an item.
                    </ApiParameter>
                    <ApiParameter Name="HasChildrenField" Type="Func&lt;TItem, bool&gt;?" Default="null">
                        Function to determine if an item has children (for lazy loading).
                    </ApiParameter>
                    <ApiParameter Name="SelectionMode" Type="TreeSelectionMode" Default="None">
                        Selection mode: None, Single, or Multiple.
                    </ApiParameter>
                    <ApiParameter Name="SelectedValue" Type="string?" Default="null">
                        Selected value in single selection mode (two-way bindable).
                    </ApiParameter>
                    <ApiParameter Name="SelectedValues" Type="HashSet&lt;string&gt;?" Default="null">
                        Selected values in multiple selection mode (two-way bindable).
                    </ApiParameter>
                    <ApiParameter Name="ExpandedValues" Type="HashSet&lt;string&gt;?" Default="null">
                        Controls which nodes are expanded (two-way bindable).
                    </ApiParameter>
                    <ApiParameter Name="DefaultExpandAll" Type="bool" Default="false">
                        Whether to expand all nodes on initial render.
                    </ApiParameter>
                    <ApiParameter Name="DefaultExpandDepth" Type="int?" Default="null">
                        Expand nodes to this depth on initial render.
                    </ApiParameter>
                    <ApiParameter Name="Checkable" Type="bool" Default="false">
                        Whether nodes display tri-state checkboxes.
                    </ApiParameter>
                    <ApiParameter Name="CheckStrictly" Type="bool" Default="false">
                        When true, disables parent/child checkbox cascade. Each checkbox is independent.
                    </ApiParameter>
                    <ApiParameter Name="CheckedValues" Type="HashSet&lt;string&gt;?" Default="null">
                        Checked node values (two-way bindable).
                    </ApiParameter>
                    <ApiParameter Name="ShowLines" Type="bool" Default="false">
                        Whether to show connector lines between nodes.
                    </ApiParameter>
                    <ApiParameter Name="ShowIcons" Type="bool" Default="true">
                        Whether to show node icons.
                    </ApiParameter>
                    <ApiParameter Name="ShowSearch" Type="bool" Default="false">
                        Whether to show the built-in search input.
                    </ApiParameter>
                    <ApiParameter Name="SearchPlaceholder" Type="string" Default="&quot;Search...&quot;">
                        Placeholder text for the search input.
                    </ApiParameter>
                    <ApiParameter Name="ExpandOnClick" Type="bool" Default="false">
                        Whether clicking a parent node also toggles its expanded state. When true, clicking anywhere on a node with children expands or collapses it in addition to selecting it.
                    </ApiParameter>
                    <ApiParameter Name="Draggable" Type="bool" Default="false">
                        Whether drag and drop is enabled.
                    </ApiParameter>
                    <ApiParameter Name="OnNodeDrop" Type="EventCallback&lt;TreeDropEventArgs&lt;TItem&gt;&gt;">
                        Event callback when a node is dropped during drag and drop.
                    </ApiParameter>
                    <ApiParameter Name="OnLoadChildren" Type="Func&lt;TItem, Task&lt;IEnumerable&lt;TItem&gt;&gt;&gt;?" Default="null">
                        Async callback to load children on demand when a node is expanded.
                    </ApiParameter>
                    <ApiParameter Name="OnNodeClick" Type="EventCallback&lt;TItem&gt;">
                        Fired when a node is clicked.
                    </ApiParameter>
                    <ApiParameter Name="OnNodeExpand" Type="EventCallback&lt;TItem&gt;">
                        Fired when a node is expanded.
                    </ApiParameter>
                    <ApiParameter Name="OnNodeCollapse" Type="EventCallback&lt;TItem&gt;">
                        Fired when a node is collapsed.
                    </ApiParameter>
                    <ApiParameter Name="AriaLabel" Type="string?" Default="null">
                        ARIA label for the tree root element.
                    </ApiParameter>
                    <ApiParameter Name="Class" Type="string?" Default="null">
                        Additional CSS classes for the tree container.
                    </ApiParameter>
                </ApiReference>

                <ApiReference ComponentName="BbTreeItem">
                    <ApiParameter Name="Value" Type="string" Default="(required)">
                        Unique value/identifier for this node.
                    </ApiParameter>
                    <ApiParameter Name="Label" Type="string?" Default="null">
                        Display text for the node.
                    </ApiParameter>
                    <ApiParameter Name="Icon" Type="string?" Default="null">
                        Lucide icon name for the node.
                    </ApiParameter>
                    <ApiParameter Name="Badge" Type="string?" Default="null">
                        Badge text shown after the label.
                    </ApiParameter>
                    <ApiParameter Name="Disabled" Type="bool" Default="false">
                        Whether this node is disabled (cannot be selected or checked).
                    </ApiParameter>
                    <ApiParameter Name="Checkable" Type="bool?" Default="null">
                        Override the parent tree's checkable setting for this node.
                    </ApiParameter>
                    <ApiParameter Name="IsLeaf" Type="bool?" Default="null">
                        Explicitly mark as a leaf node (no expand arrow).
                    </ApiParameter>
                    <ApiParameter Name="LabelTemplate" Type="RenderFragment?" Default="null">
                        Custom label content replacing the default text.
                    </ApiParameter>
                    <ApiParameter Name="ActionsTemplate" Type="RenderFragment?" Default="null">
                        Action buttons shown on hover (e.g., edit, delete).
                    </ApiParameter>
                    <ApiParameter Name="Class" Type="string?" Default="null">
                        Additional CSS classes for the node row.
                    </ApiParameter>
                </ApiReference>
            </div>
        </section>
    </div>
</div>

@code {
    // --- Selection state ---
    private string? selectedCategory;
    private HashSet<string> selectedFlatIds = new();
    private string? singleSelectedValue;
    private HashSet<string> multiSelectedValues = new();
    private HashSet<string> checkedPermissions = new();
    private string? selectedLazyNode;
    private string? selectedFile;
    private string dragMessage = "Drag a node to reorder.";

    // --- Controlled tree ---
    private HashSet<string> controlledExpandedValues = new() { "c-root" };

    private void ExpandAllControlled()
    {
        controlledExpandedValues = new HashSet<string> { "c-root", "c-branch1", "c-branch2" };
    }

    private void CollapseAllControlled()
    {
        controlledExpandedValues = new HashSet<string>();
    }

    // --- Nested category data ---
    private List<CategoryNode> nestedCategories = new()
    {
        new CategoryNode
        {
            Id = "electronics", Name = "Electronics", Icon = "cpu",
            Children = new List<CategoryNode>
            {
                new CategoryNode
                {
                    Id = "phones", Name = "Phones", Icon = "smartphone",
                    Children = new List<CategoryNode>
                    {
                        new CategoryNode { Id = "iphone", Name = "iPhone", Icon = "smartphone" },
                        new CategoryNode { Id = "samsung", Name = "Samsung Galaxy", Icon = "smartphone" },
                        new CategoryNode { Id = "pixel", Name = "Google Pixel", Icon = "smartphone" }
                    }
                },
                new CategoryNode
                {
                    Id = "laptops", Name = "Laptops", Icon = "laptop",
                    Children = new List<CategoryNode>
                    {
                        new CategoryNode { Id = "macbook", Name = "MacBook", Icon = "laptop" },
                        new CategoryNode { Id = "thinkpad", Name = "ThinkPad", Icon = "laptop" }
                    }
                },
                new CategoryNode { Id = "tablets", Name = "Tablets", Icon = "tablet" }
            }
        },
        new CategoryNode
        {
            Id = "clothing", Name = "Clothing", Icon = "shirt",
            Children = new List<CategoryNode>
            {
                new CategoryNode { Id = "mens", Name = "Men's", Icon = "shirt" },
                new CategoryNode { Id = "womens", Name = "Women's", Icon = "shirt" },
                new CategoryNode { Id = "kids", Name = "Kids", Icon = "baby" }
            }
        },
        new CategoryNode { Id = "books", Name = "Books", Icon = "book-open" }
    };

    // --- Flat data ---
    private List<FlatNode> flatNodes = new()
    {
        new FlatNode { Id = "usa", Name = "United States", ParentId = null },
        new FlatNode { Id = "ca", Name = "California", ParentId = "usa" },
        new FlatNode { Id = "ny", Name = "New York", ParentId = "usa" },
        new FlatNode { Id = "tx", Name = "Texas", ParentId = "usa" },
        new FlatNode { Id = "sf", Name = "San Francisco", ParentId = "ca" },
        new FlatNode { Id = "la", Name = "Los Angeles", ParentId = "ca" },
        new FlatNode { Id = "nyc", Name = "New York City", ParentId = "ny" },
        new FlatNode { Id = "uk", Name = "United Kingdom", ParentId = null },
        new FlatNode { Id = "london", Name = "London", ParentId = "uk" },
        new FlatNode { Id = "manchester", Name = "Manchester", ParentId = "uk" }
    };

    // --- Lazy loading ---
    private List<LazyNode> lazyRootNodes = new()
    {
        new LazyNode { Id = "dept-eng", Name = "Engineering", Icon = "code", HasChildren = true },
        new LazyNode { Id = "dept-design", Name = "Design", Icon = "palette", HasChildren = true },
        new LazyNode { Id = "dept-marketing", Name = "Marketing", Icon = "megaphone", HasChildren = true }
    };

    private async Task<IEnumerable<LazyNode>> LoadLazyChildren(LazyNode parent)
    {
        // Simulate network delay
        await Task.Delay(1000);

        return parent.Id switch
        {
            "dept-eng" => new List<LazyNode>
            {
                new LazyNode { Id = "team-frontend", Name = "Frontend", Icon = "monitor", HasChildren = true },
                new LazyNode { Id = "team-backend", Name = "Backend", Icon = "server", HasChildren = true },
                new LazyNode { Id = "team-infra", Name = "Infrastructure", Icon = "cloud", HasChildren = false }
            },
            "dept-design" => new List<LazyNode>
            {
                new LazyNode { Id = "team-ux", Name = "UX Research", Icon = "search", HasChildren = false },
                new LazyNode { Id = "team-ui", Name = "UI Design", Icon = "figma", HasChildren = false }
            },
            "dept-marketing" => new List<LazyNode>
            {
                new LazyNode { Id = "team-content", Name = "Content", Icon = "pen-tool", HasChildren = false },
                new LazyNode { Id = "team-social", Name = "Social Media", Icon = "share-2", HasChildren = false }
            },
            "team-frontend" => new List<LazyNode>
            {
                new LazyNode { Id = "alice", Name = "Alice", Icon = "user", HasChildren = false },
                new LazyNode { Id = "bob", Name = "Bob", Icon = "user", HasChildren = false }
            },
            "team-backend" => new List<LazyNode>
            {
                new LazyNode { Id = "charlie", Name = "Charlie", Icon = "user", HasChildren = false },
                new LazyNode { Id = "diana", Name = "Diana", Icon = "user", HasChildren = false }
            },
            _ => Enumerable.Empty<LazyNode>()
        };
    }

    // --- Drag and drop ---
    private List<DragNode> dragItems = new()
    {
        new DragNode
        {
            Id = "todo", Name = "To Do", Icon = "circle",
            Children = new List<DragNode>
            {
                new DragNode { Id = "task1", Name = "Design mockups", Icon = "file" },
                new DragNode { Id = "task2", Name = "Write tests", Icon = "file" }
            }
        },
        new DragNode
        {
            Id = "inprogress", Name = "In Progress", Icon = "clock",
            Children = new List<DragNode>
            {
                new DragNode { Id = "task3", Name = "Build API", Icon = "file" }
            }
        },
        new DragNode
        {
            Id = "done", Name = "Done", Icon = "circle-check",
            Children = new List<DragNode>
            {
                new DragNode { Id = "task4", Name = "Setup CI/CD", Icon = "file" }
            }
        }
    };

    private Task HandleDrop(TreeDropEventArgs<DragNode> args)
    {
        var source = args.SourceNode;
        var target = args.TargetNode;

        // Remove source from its current location
        RemoveDragNode(dragItems, source.Id);

        // Insert at the new position
        switch (args.Position)
        {
            case TreeDropPosition.Inside:
                target.Children ??= new List<DragNode>();
                target.Children.Add(source);
                break;

            case TreeDropPosition.Before:
            case TreeDropPosition.After:
                var parentList = FindDragParentList(dragItems, target.Id);
                if (parentList != null)
                {
                    var idx = parentList.FindIndex(n => n.Id == target.Id);
                    if (idx >= 0)
                    {
                        parentList.Insert(args.Position == TreeDropPosition.Before ? idx : idx + 1, source);
                    }
                }
                break;
        }

        dragMessage = $"Moved '{source.Name}' {args.Position.ToString().ToLower()} '{target.Name}'";
        StateHasChanged();
        return Task.CompletedTask;
    }

    private bool RemoveDragNode(List<DragNode> nodes, string id)
    {
        for (var i = 0; i < nodes.Count; i++)
        {
            if (nodes[i].Id == id)
            {
                nodes.RemoveAt(i);
                return true;
            }

            if (nodes[i].Children != null && RemoveDragNode(nodes[i].Children!, id))
            {
                return true;
            }
        }

        return false;
    }

    private List<DragNode>? FindDragParentList(List<DragNode> nodes, string id)
    {
        foreach (var node in nodes)
        {
            if (node.Id == id)
            {
                return nodes;
            }

            if (node.Children != null)
            {
                var found = FindDragParentList(node.Children, id);
                if (found != null)
                {
                    return found;
                }
            }
        }

        return null;
    }

    // --- File explorer data ---
    private List<CategoryNode> fileExplorerData = new()
    {
        new CategoryNode
        {
            Id = "fe-src", Name = "src", Icon = "folder",
            Children = new List<CategoryNode>
            {
                new CategoryNode
                {
                    Id = "fe-components", Name = "components", Icon = "folder",
                    Children = new List<CategoryNode>
                    {
                        new CategoryNode { Id = "fe-button", Name = "Button.razor", Icon = "file-code" },
                        new CategoryNode { Id = "fe-input", Name = "Input.razor", Icon = "file-code" },
                        new CategoryNode { Id = "fe-dialog", Name = "Dialog.razor", Icon = "file-code" },
                        new CategoryNode { Id = "fe-treeview", Name = "TreeView.razor", Icon = "file-code" }
                    }
                },
                new CategoryNode
                {
                    Id = "fe-pages", Name = "pages", Icon = "folder",
                    Children = new List<CategoryNode>
                    {
                        new CategoryNode { Id = "fe-index", Name = "Index.razor", Icon = "file-code" },
                        new CategoryNode { Id = "fe-about", Name = "About.razor", Icon = "file-code" }
                    }
                },
                new CategoryNode { Id = "fe-app", Name = "App.razor", Icon = "file-code" },
                new CategoryNode { Id = "fe-program", Name = "Program.cs", Icon = "file-code" }
            }
        },
        new CategoryNode
        {
            Id = "fe-tests", Name = "tests", Icon = "folder",
            Children = new List<CategoryNode>
            {
                new CategoryNode { Id = "fe-unit", Name = "UnitTests.cs", Icon = "file-code" },
                new CategoryNode { Id = "fe-integration", Name = "IntegrationTests.cs", Icon = "file-code" }
            }
        },
        new CategoryNode { Id = "fe-readme", Name = "README.md", Icon = "file" },
        new CategoryNode { Id = "fe-gitignore", Name = ".gitignore", Icon = "file" },
        new CategoryNode { Id = "fe-sln", Name = "Solution.sln", Icon = "file-code" }
    };

    // --- Data model classes ---
    private class CategoryNode
    {
        public string Id { get; set; } = string.Empty;
        public string Name { get; set; } = string.Empty;
        public string? Icon { get; set; }
        public List<CategoryNode>? Children { get; set; }
    }

    private class FlatNode
    {
        public string Id { get; set; } = string.Empty;
        public string Name { get; set; } = string.Empty;
        public string? ParentId { get; set; }
    }

    private class LazyNode
    {
        public string Id { get; set; } = string.Empty;
        public string Name { get; set; } = string.Empty;
        public string? Icon { get; set; }
        public bool HasChildren { get; set; }
        public List<LazyNode>? Children { get; set; }
    }

    private class DragNode
    {
        public string Id { get; set; } = string.Empty;
        public string Name { get; set; } = string.Empty;
        public string? Icon { get; set; }
        public List<DragNode>? Children { get; set; }
    }
}
