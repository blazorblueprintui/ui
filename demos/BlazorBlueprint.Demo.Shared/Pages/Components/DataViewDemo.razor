@page "/components/dataview"
@using BlazorBlueprint.Demo.Services
@inject MockDataService MockDataService

<PageTitle>Data View Component - Blazor Blueprint</PageTitle>

<div class="space-y-8 max-w-7xl">
    <div class="space-y-3">
        <h1 class="text-4xl font-bold tracking-tight">Data View Component</h1>
        <p class="text-xl text-muted-foreground">
            A flexible data view component with list and grid layouts, sorting, filtering, pagination,
            and optional infinite scroll.
        </p>
    </div>

    <!-- ── Employee Directory – List only ─────────────────────────────────── -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Employee Directory (List)</h2>
            <p class="text-sm text-muted-foreground">
                Provide only <code class="bg-muted px-1 py-0.5 rounded">ListTemplate</code> to lock the view
                into list mode. The layout-toggle buttons are hidden when only one template is set.
                Register <code class="bg-muted px-1 py-0.5 rounded">BbDataViewField</code> components
                inside <code class="bg-muted px-1 py-0.5 rounded">Fields</code> for sort and filter support.
            </p>
        </div>
        <BbDataView TItem="Person" Data="@people" InitialPageSize="5">
            <ListTemplate Context="person">
                <BbCard Class="flex items-center gap-4 p-4 shadow-none hover:bg-accent/50 transition-colors">
                    <BbAvatar>
                        <BbAvatarFallback>@GetInitials(person.Name)</BbAvatarFallback>
                    </BbAvatar>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-semibold truncate">@person.Name</p>
                        <BbTypographyMuted Class="truncate">@person.Email</BbTypographyMuted>
                        <BbTypographyMuted Class="text-xs">@person.Department · @person.Role</BbTypographyMuted>
                    </div>
                    <div class="flex flex-col items-end gap-1 shrink-0">
                        <BbBadge Variant="@(person.Status == "Active" ? BadgeVariant.Default : BadgeVariant.Outline)">
                            @person.Status
                        </BbBadge>
                        <BbTypographyMuted Class="text-xs">@person.Salary.ToString("C0")</BbTypographyMuted>
                    </div>
                </BbCard>
            </ListTemplate>
            <Fields>
                <BbDataViewField TItem="Person" TValue="string" Property="@(p => p.Name)"       Header="Name"       Sortable Filterable />
                <BbDataViewField TItem="Person" TValue="string" Property="@(p => p.Email)"      Header="Email"      Filterable />
                <BbDataViewField TItem="Person" TValue="string" Property="@(p => p.Department)" Header="Department" Sortable Filterable />
                <BbDataViewField TItem="Person" TValue="string" Property="@(p => p.Role)"       Header="Role"       Sortable Filterable />
                <BbDataViewField TItem="Person" TValue="string" Property="@(p => p.Status)"     Header="Status"     Sortable />
                <BbDataViewField TItem="Person" TValue="int"    Property="@(p => p.Salary)"     Header="Salary"     Sortable />
            </Fields>
        </BbDataView>
        <CodeBlock Source="Components/DataView/basic.txt" />
    </div>

    <!-- ── Product Catalog – both templates, layout toggle enabled ────────── -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Product Catalog (List + Grid Toggle)</h2>
            <p class="text-sm text-muted-foreground">
                Provide both <code class="bg-muted px-1 py-0.5 rounded">ListTemplate</code> and
                <code class="bg-muted px-1 py-0.5 rounded">GridTemplate</code> to enable the toolbar
                layout-toggle buttons. Each template can be designed independently — the list template
                is a compact horizontal row and the grid template is a richer card with an image.
                Use <code class="bg-muted px-1 py-0.5 rounded">HeaderContent</code> and
                <code class="bg-muted px-1 py-0.5 rounded">FooterContent</code> for unstyled slot areas.
            </p>
        </div>
        <BbDataView TItem="Product" Data="@products" InitialPageSize="12"
                    PageSizes="@(new[] { 6, 12, 24, 48 })">
            <HeaderContent>
                <div class="flex items-center justify-between pb-4 border-b">
                    <div>
                        <p class="text-lg font-semibold">Our Products</p>
                        <BbTypographyMuted>@products.Count items · free shipping over $50</BbTypographyMuted>
                    </div>
                    <BbBadge Variant="BadgeVariant.Secondary">@products.Count(p => p.Stock > 0) in stock</BbBadge>
                </div>
            </HeaderContent>
            <ListTemplate Context="product">
                <BbCard Class="flex items-center gap-4 p-3 shadow-none hover:bg-accent/50 transition-colors">
                    <div class="size-16 shrink-0 rounded-md overflow-hidden bg-muted">
                        <img src="@product.ImageUrl" alt="@product.Name"
                             class="object-cover w-full h-full" loading="lazy" />
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2">
                            <p class="text-sm font-semibold truncate">@product.Name</p>
                            <BbBadge Variant="BadgeVariant.Outline" Class="shrink-0 text-xs">@product.Category</BbBadge>
                        </div>
                        <BbRating Value="@product.Rating" ReadOnly="true" Size="RatingSize.Small" />
                    </div>
                    <div class="flex flex-col items-end gap-2 shrink-0">
                        <span class="text-base font-bold">$@product.Price.ToString("F2")</span>
                        @if (product.Stock == 0)
                        {
                            <BbBadge Variant="BadgeVariant.Destructive">Out of Stock</BbBadge>
                        }
                        else if (product.Stock <= 5)
                        {
                            <BbBadge Variant="BadgeVariant.Secondary">Low stock</BbBadge>
                        }
                        else
                        {
                            <BbButton Size="ButtonSize.Small">Add to Cart</BbButton>
                        }
                    </div>
                </BbCard>
            </ListTemplate>
            <GridTemplate Context="product">
                <BbCard Class="overflow-hidden flex flex-col hover:shadow-md transition-shadow">
                    <div class="relative aspect-square overflow-hidden bg-muted">
                        <img src="@product.ImageUrl" alt="@product.Name"
                             class="object-cover w-full h-full transition-transform hover:scale-105 duration-300"
                             loading="lazy" />
                        @if (product.Stock == 0)
                        {
                            <div class="absolute inset-0 bg-background/70 flex items-center justify-center">
                                <BbTypographyMuted>Out of Stock</BbTypographyMuted>
                            </div>
                        }
                        else if (product.Stock <= 5)
                        {
                            <div class="absolute top-2 right-2">
                                <BbBadge Variant="BadgeVariant.Destructive">Low stock</BbBadge>
                            </div>
                        }
                    </div>
                    <BbCardContent Class="flex flex-col gap-2 flex-1 p-4">
                        <div class="flex items-start justify-between gap-2">
                            <p class="text-sm font-semibold leading-snug line-clamp-2">@product.Name</p>
                            <BbBadge Variant="BadgeVariant.Outline" Class="shrink-0 text-xs">@product.Category</BbBadge>
                        </div>
                        <BbRating Value="@product.Rating" ReadOnly="true" Size="RatingSize.Small" />
                        <BbSeparator />
                        <div class="flex items-center justify-between">
                            <span class="text-base font-bold">$@product.Price.ToString("F2")</span>
                            <BbButton Size="ButtonSize.Small"
                                      Variant="@(product.Stock > 0 ? ButtonVariant.Default : ButtonVariant.Outline)"
                                      Disabled="@(product.Stock == 0)">
                                @(product.Stock > 0 ? "Add to Cart" : "Notify Me")
                            </BbButton>
                        </div>
                    </BbCardContent>
                </BbCard>
            </GridTemplate>
            <FooterContent>
                <div class="flex items-center justify-between pt-4 border-t">
                    <BbTypographyMuted>Prices include VAT. Free returns within 30 days.</BbTypographyMuted>
                    <BbTypographyMuted>© 2025 Demo Store</BbTypographyMuted>
                </div>
            </FooterContent>
            <Fields>
                <BbDataViewField TItem="Product" TValue="string"  Property="@(p => p.Name)"     Header="Name"     Sortable Filterable />
                <BbDataViewField TItem="Product" TValue="string"  Property="@(p => p.Category)" Header="Category" Sortable Filterable />
                <BbDataViewField TItem="Product" TValue="decimal" Property="@(p => p.Price)"    Header="Price"    Sortable />
                <BbDataViewField TItem="Product" TValue="double"  Property="@(p => p.Rating)"   Header="Rating"   Sortable />
            </Fields>
        </BbDataView>
        <CodeBlock Source="Components/DataView/product-catalog.txt" />
    </div>

    <!-- ── Header and Footer Slots ────────────────────────────────────────── -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Header &amp; Footer Slots</h2>
            <p class="text-sm text-muted-foreground">
                Use the <code class="bg-muted px-1 py-0.5 rounded">HeaderContent</code> and
                <code class="bg-muted px-1 py-0.5 rounded">FooterContent</code> parameters to render
                custom content above and below the view. The slots are completely unstyled — you own
                every border, background, and spacing choice.
            </p>
        </div>
        <BbDataView TItem="Person" Data="@people" InitialPageSize="4">
            <HeaderContent>
                <div class="flex items-center justify-between rounded-t-lg border border-b-0 bg-card px-6 py-4">
                    <div>
                        <p class="text-base font-semibold">Team Members</p>
                        <BbTypographyMuted>Browse and search your team directory.</BbTypographyMuted>
                    </div>
                    <BbButton Variant="ButtonVariant.Default" Size="ButtonSize.Small">
                        Add Member
                    </BbButton>
                </div>
            </HeaderContent>
            <ListTemplate Context="person">
                <BbCard Class="flex items-center gap-4 p-4 shadow-none">
                    <BbAvatar>
                        <BbAvatarFallback>@GetInitials(person.Name)</BbAvatarFallback>
                    </BbAvatar>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-semibold truncate">@person.Name</p>
                        <BbTypographyMuted Class="truncate">@person.Email</BbTypographyMuted>
                    </div>
                    <BbBadge Variant="BadgeVariant.Secondary">@person.Department</BbBadge>
                </BbCard>
            </ListTemplate>
            <FooterContent>
                <div class="rounded-b-lg border border-t-0 bg-muted/30 px-6 py-3">
                    <BbTypographyMuted>Showing filtered results from @people.Count total records.</BbTypographyMuted>
                </div>
            </FooterContent>
            <Fields>
                <BbDataViewField TItem="Person" TValue="string" Property="@(p => p.Name)"       Header="Name"       Sortable Filterable />
                <BbDataViewField TItem="Person" TValue="string" Property="@(p => p.Department)" Header="Department" Sortable Filterable />
                <BbDataViewField TItem="Person" TValue="string" Property="@(p => p.Email)"      Header="Email"      Filterable />
            </Fields>
        </BbDataView>
        <CodeBlock Source="Components/DataView/header-footer.txt" />
    </div>

    <!-- ── Layout Customization ───────────────────────────────────────────── -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Layout Customization (Columns, Gap &amp; Spacing)</h2>
            <p class="text-sm text-muted-foreground">
                Both <code class="bg-muted px-1 py-0.5 rounded">GridClass</code> and
                <code class="bg-muted px-1 py-0.5 rounded">ListClass</code> are merged on top of their
                respective defaults using TailwindMerge — so you only need to supply the classes you want
                to override; the rest of the defaults are preserved. The default grid is
                <code class="bg-muted px-1 py-0.5 rounded">grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4</code>
                and the default list is
                <code class="bg-muted px-1 py-0.5 rounded">flex flex-col gap-2</code>.
            </p>
        </div>

        <!-- 4-column grid -->
        <div class="space-y-2">
            <p class="font-medium text-sm">4-column grid (<code class="bg-muted px-1 py-0.5 rounded">GridClass="grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"</code>)</p>
            <BbDataView TItem="Product" Data="@products" InitialPageSize="12"
                        GridClass="grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                <GridTemplate Context="product">
                    <BbCard Class="overflow-hidden flex flex-col">
                        <div class="aspect-square overflow-hidden bg-muted">
                            <img src="@product.ImageUrl" alt="@product.Name"
                                 class="object-cover w-full h-full" loading="lazy" />
                        </div>
                        <BbCardContent Class="p-3 flex flex-col gap-1">
                            <p class="text-xs font-semibold line-clamp-2">@product.Name</p>
                            <BbTypographyMuted Class="text-xs">@product.Category</BbTypographyMuted>
                            <span class="text-sm font-bold">$@product.Price.ToString("F2")</span>
                        </BbCardContent>
                    </BbCard>
                </GridTemplate>
                <Fields>
                    <BbDataViewField TItem="Product" TValue="string"  Property="@(p => p.Name)"     Header="Name"     Sortable Filterable />
                    <BbDataViewField TItem="Product" TValue="string"  Property="@(p => p.Category)" Header="Category" Sortable Filterable />
                    <BbDataViewField TItem="Product" TValue="decimal" Property="@(p => p.Price)"    Header="Price"    Sortable />
                </Fields>
            </BbDataView>
        </div>

        <!-- 2-column grid with large gap -->
        <div class="space-y-2">
            <p class="font-medium text-sm">2-column grid with large gap (<code class="bg-muted px-1 py-0.5 rounded">GridClass="grid-cols-1 sm:grid-cols-2 gap-6"</code>)</p>
            <BbDataView TItem="Product" Data="@products" InitialPageSize="6"
                        PageSizes="@(new[] { 6, 12 })"
                        GridClass="grid-cols-1 sm:grid-cols-2 gap-6">
                <GridTemplate Context="product">
                    <BbCard Class="overflow-hidden flex flex-col hover:shadow-md transition-shadow">
                        <div class="relative aspect-video overflow-hidden bg-muted">
                            <img src="@product.ImageUrl" alt="@product.Name"
                                 class="object-cover w-full h-full" loading="lazy" />
                        </div>
                        <BbCardContent Class="flex flex-col gap-2 p-4">
                            <div class="flex items-start justify-between gap-2">
                                <p class="text-sm font-semibold">@product.Name</p>
                                <BbBadge Variant="BadgeVariant.Outline" Class="shrink-0 text-xs">@product.Category</BbBadge>
                            </div>
                            <BbRating Value="@product.Rating" ReadOnly="true" Size="RatingSize.Small" />
                            <BbSeparator />
                            <div class="flex items-center justify-between">
                                <span class="text-base font-bold">$@product.Price.ToString("F2")</span>
                                <BbButton Size="ButtonSize.Small"
                                          Variant="@(product.Stock > 0 ? ButtonVariant.Default : ButtonVariant.Outline)"
                                          Disabled="@(product.Stock == 0)">
                                    @(product.Stock > 0 ? "Add to Cart" : "Notify Me")
                                </BbButton>
                            </div>
                        </BbCardContent>
                    </BbCard>
                </GridTemplate>
                <Fields>
                    <BbDataViewField TItem="Product" TValue="string"  Property="@(p => p.Name)"     Header="Name"     Sortable Filterable />
                    <BbDataViewField TItem="Product" TValue="string"  Property="@(p => p.Category)" Header="Category" Sortable Filterable />
                    <BbDataViewField TItem="Product" TValue="decimal" Property="@(p => p.Price)"    Header="Price"    Sortable />
                </Fields>
            </BbDataView>
        </div>

        <!-- Compact divider list -->
        <div class="space-y-2">
            <p class="font-medium text-sm">Compact divider list (<code class="bg-muted px-1 py-0.5 rounded">ListClass="gap-0 divide-y"</code>)</p>
            <BbDataView TItem="Person" Data="@people" InitialPageSize="6" ListClass="gap-0 divide-y">
                <ListTemplate Context="person">
                    <div class="flex items-center gap-4 px-4 py-3 hover:bg-accent/50 transition-colors">
                        <BbAvatar>
                            <BbAvatarFallback>@GetInitials(person.Name)</BbAvatarFallback>
                        </BbAvatar>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-semibold truncate">@person.Name</p>
                            <BbTypographyMuted Class="truncate">@person.Email</BbTypographyMuted>
                        </div>
                        <BbBadge Variant="BadgeVariant.Secondary">@person.Department</BbBadge>
                    </div>
                </ListTemplate>
                <Fields>
                    <BbDataViewField TItem="Person" TValue="string" Property="@(p => p.Name)"       Header="Name"       Sortable Filterable />
                    <BbDataViewField TItem="Person" TValue="string" Property="@(p => p.Department)" Header="Department" Sortable Filterable />
                    <BbDataViewField TItem="Person" TValue="string" Property="@(p => p.Email)"      Header="Email"      Filterable />
                </Fields>
            </BbDataView>
        </div>

        <CodeBlock Source="Components/DataView/layout-customization.txt" />
    </div>

    <!-- ── Infinite Scroll – Product Grid (Auto, GridTemplate only) ───────── -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Infinite Scroll – Product Grid (Auto)</h2>
            <p class="text-sm text-muted-foreground">
                Set <code class="bg-muted px-1 py-0.5 rounded">EnableInfiniteScroll</code> with
                <code class="bg-muted px-1 py-0.5 rounded">ScrollHeight</code> to progressively load
                more items as the user scrolls. Only <code class="bg-muted px-1 py-0.5 rounded">GridTemplate</code>
                is set here, so the view locks into grid mode with no toggle. Sorting or filtering resets
                to the first batch.
            </p>
        </div>
        <BbDataView TItem="Product" Data="@products"
                    EnableInfiniteScroll="true" ScrollHeight="600px" InitialPageSize="6">
            <GridTemplate Context="product">
                <BbCard Class="overflow-hidden flex flex-col hover:shadow-md transition-shadow">
                    <div class="relative aspect-square overflow-hidden bg-muted">
                        <img src="@product.ImageUrl" alt="@product.Name"
                             class="object-cover w-full h-full transition-transform hover:scale-105 duration-300"
                             loading="lazy" />
                        @if (product.Stock == 0)
                        {
                            <div class="absolute inset-0 bg-background/70 flex items-center justify-center">
                                <BbTypographyMuted>Out of Stock</BbTypographyMuted>
                            </div>
                        }
                    </div>
                    <BbCardContent Class="flex flex-col gap-2 flex-1 p-4">
                        <div class="flex items-start justify-between gap-2">
                            <p class="text-sm font-semibold leading-snug line-clamp-2">@product.Name</p>
                            <BbBadge Variant="BadgeVariant.Outline" Class="shrink-0 text-xs">@product.Category</BbBadge>
                        </div>
                        <BbRating Value="@product.Rating" ReadOnly="true" Size="RatingSize.Small" />
                        <BbSeparator />
                        <div class="flex items-center justify-between">
                            <span class="text-base font-bold">$@product.Price.ToString("F2")</span>
                            <BbButton Size="ButtonSize.Small"
                                      Variant="@(product.Stock > 0 ? ButtonVariant.Default : ButtonVariant.Outline)"
                                      Disabled="@(product.Stock == 0)">
                                @(product.Stock > 0 ? "Add to Cart" : "Notify Me")
                            </BbButton>
                        </div>
                    </BbCardContent>
                </BbCard>
            </GridTemplate>
            <Fields>
                <BbDataViewField TItem="Product" TValue="string"  Property="@(p => p.Name)"     Header="Name"     Sortable Filterable />
                <BbDataViewField TItem="Product" TValue="string"  Property="@(p => p.Category)" Header="Category" Sortable Filterable />
                <BbDataViewField TItem="Product" TValue="decimal" Property="@(p => p.Price)"    Header="Price"    Sortable />
                <BbDataViewField TItem="Product" TValue="double"  Property="@(p => p.Rating)"   Header="Rating"   Sortable />
            </Fields>
        </BbDataView>
        <CodeBlock Source="Components/DataView/product-infinite-scroll.txt" />
    </div>

    <!-- ── Infinite Scroll – Auto (scroll-based, ListTemplate only) ───────── -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Infinite Scroll – Employee List (Auto)</h2>
            <p class="text-sm text-muted-foreground">
                Only <code class="bg-muted px-1 py-0.5 rounded">ListTemplate</code> is set, so the view
                locks into list mode. Set
                <code class="bg-muted px-1 py-0.5 rounded">ScrollHeight</code> to any valid CSS height for
                the scroll container — detection works for both flex lists and multi-column grids because
                the container is measured as a whole.
            </p>
        </div>
        <BbDataView TItem="Person" Data="@people" EnableInfiniteScroll="true" ScrollHeight="480px" InitialPageSize="6">
            <ListTemplate Context="person">
                <BbCard Class="flex items-center gap-4 p-4 shadow-none hover:bg-accent/50 transition-colors">
                    <BbAvatar>
                        <BbAvatarFallback>@GetInitials(person.Name)</BbAvatarFallback>
                    </BbAvatar>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-semibold truncate">@person.Name</p>
                        <BbTypographyMuted Class="truncate">@person.Email</BbTypographyMuted>
                        <BbTypographyMuted Class="text-xs">@person.Department · @person.Role</BbTypographyMuted>
                    </div>
                    <BbBadge Variant="BadgeVariant.Outline">@person.Age yrs</BbBadge>
                </BbCard>
            </ListTemplate>
            <Fields>
                <BbDataViewField TItem="Person" TValue="string" Property="@(p => p.Name)" Header="Name" Sortable Filterable />
                <BbDataViewField TItem="Person" TValue="string" Property="@(p => p.Role)" Header="Role" Sortable Filterable />
                <BbDataViewField TItem="Person" TValue="int"    Property="@(p => p.Age)"  Header="Age"  Sortable />
            </Fields>
        </BbDataView>
        <CodeBlock Source="Components/DataView/infinite-scroll.txt" />
    </div>

    <!-- ── Loading State ──────────────────────────────────────────────────── -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Loading State</h2>
            <p class="text-sm text-muted-foreground">
                Set <code class="bg-muted px-1 py-0.5 rounded">IsLoading</code> to show a loading indicator
                while data is being fetched. Provide
                <code class="bg-muted px-1 py-0.5 rounded">LoadingTemplate</code> to replace the default
                indicator with skeleton cards or any custom content.
            </p>
        </div>
        <BbButton Variant="ButtonVariant.Outline" Size="ButtonSize.Small" OnClick="@(() => isLoading = !isLoading)">
            Toggle Loading
        </BbButton>
        <BbDataView TItem="Person" Data="@people" IsLoading="@isLoading" InitialPageSize="4">
            <ListTemplate Context="person">
                <BbCard Class="flex items-center gap-4 p-4 shadow-none">
                    <BbAvatar>
                        <BbAvatarFallback>@GetInitials(person.Name)</BbAvatarFallback>
                    </BbAvatar>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-semibold">@person.Name</p>
                        <BbTypographyMuted>@person.Email</BbTypographyMuted>
                    </div>
                </BbCard>
            </ListTemplate>
            <Fields>
                <BbDataViewField TItem="Person" TValue="string" Property="@(p => p.Name)" Header="Name" Sortable Filterable />
            </Fields>
        </BbDataView>
        <CodeBlock Source="Components/DataView/loading.txt" />
    </div>

    <!-- ── Empty State ────────────────────────────────────────────────────── -->
    <div class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">Empty State</h2>
            <p class="text-sm text-muted-foreground">
                Displays the default empty state when there are no results. Provide
                <code class="bg-muted px-1 py-0.5 rounded">EmptyTemplate</code> to render a custom state.
            </p>
        </div>
        <BbDataView TItem="Person" Data="@emptyPeople" InitialPageSize="5">
            <ListTemplate Context="person">
                <BbCard Class="p-4 shadow-none">@person.Name</BbCard>
            </ListTemplate>
            <Fields>
                <BbDataViewField TItem="Person" TValue="string" Property="@(p => p.Name)" Header="Name" Filterable />
            </Fields>
        </BbDataView>
        <CodeBlock Source="Components/DataView/empty.txt" />
    </div>

    <!-- ── Accessibility ──────────────────────────────────────────────────── -->
    <AccessibilityList>
        <AriaAttributes>
            <AccessibilityItem>Toolbar search uses a native input with <code>role="searchbox"</code> semantics via BbInput</AccessibilityItem>
            <AccessibilityItem>Layout-toggle buttons include a <code>title</code> attribute ("List view" / "Grid view") and are only rendered when both templates are provided</AccessibilityItem>
            <AccessibilityItem><code>title</code> on sort direction button describes the current sort direction and next action</AccessibilityItem>
            <AccessibilityItem>Empty state uses BbEmpty which renders descriptive text readable by screen readers</AccessibilityItem>
            <AccessibilityItem>Pagination uses BbPagination primitives with full keyboard and ARIA support</AccessibilityItem>
            <AccessibilityItem>Product images carry meaningful <code>alt</code> text derived from the item's name</AccessibilityItem>
            <AccessibilityItem>Avatar fallbacks use text initials readable by screen readers</AccessibilityItem>
        </AriaAttributes>
        <KeyboardNavigation>
            <KeyboardShortcutItem Description="Focus the global search input">
                <BbKbd>Tab</BbKbd>
            </KeyboardShortcutItem>
            <KeyboardShortcutItem Description="Open the sort field dropdown">
                <BbKbd>Enter</BbKbd> / <BbKbd>Space</BbKbd>
            </KeyboardShortcutItem>
            <KeyboardShortcutItem Description="Toggle sort direction">
                <BbKbd>Click</BbKbd>
            </KeyboardShortcutItem>
            <KeyboardShortcutItem Description="Switch layout (when both templates are set)">
                <BbKbd>Tab</BbKbd> to toggle button, then <BbKbd>Enter</BbKbd>
            </KeyboardShortcutItem>
            <KeyboardShortcutItem Description="Navigate pagination controls">
                <BbKbd>Tab</BbKbd> / <BbKbd>Shift</BbKbd>+<BbKbd>Tab</BbKbd>
            </KeyboardShortcutItem>
            <KeyboardShortcutItem Description="Activate pagination buttons">
                <BbKbd>Enter</BbKbd> / <BbKbd>Space</BbKbd>
            </KeyboardShortcutItem>
        </KeyboardNavigation>
    </AccessibilityList>

    <!-- ── API Reference ──────────────────────────────────────────────────── -->
    <section class="space-y-4">
        <div class="space-y-2">
            <h2 class="text-2xl font-semibold">API Reference</h2>
            <p class="text-muted-foreground">Component parameters and render fragments.</p>
        </div>
        <div class="space-y-4">
            <ApiReference ComponentName="DataView">
                <ApiParameter Name="Data" Type="IEnumerable&lt;TItem&gt;">
                    The data source for the view.
                </ApiParameter>
                <ApiParameter Name="ListTemplate" Type="RenderFragment&lt;TItem&gt;?" Default="null">
                    Template used to render each item in list layout. When set without GridTemplate the
                    view locks into list mode and the layout-toggle is hidden.
                </ApiParameter>
                <ApiParameter Name="GridTemplate" Type="RenderFragment&lt;TItem&gt;?" Default="null">
                    Template used to render each item in grid layout. When set without ListTemplate the
                    view locks into grid mode and the layout-toggle is hidden. Provide both templates
                    to enable the toolbar layout-toggle.
                </ApiParameter>
                <ApiParameter Name="HeaderContent" Type="RenderFragment?" Default="null">
                    Optional unstyled content rendered above the toolbar. You own all styling.
                </ApiParameter>
                <ApiParameter Name="FooterContent" Type="RenderFragment?" Default="null">
                    Optional unstyled content rendered below items and pagination. You own all styling.
                </ApiParameter>
                <ApiParameter Name="Fields" Type="RenderFragment?" Default="null">
                    Container for BbDataViewField definitions (and optional slot components).
                </ApiParameter>
                <ApiParameter Name="Layout" Type="DataViewLayout" Default="List">
                    Initial layout mode when both templates are set. Ignored when only one template
                    is provided (the view locks to that template's mode).
                </ApiParameter>
                <ApiParameter Name="GridClass" Type="string?" Default="null">
                    Extra Tailwind classes applied to the grid container. Merged on top of the default
                    <code>grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4</code> via TailwindMerge —
                    supply only the classes you want to override (e.g. <code>grid-cols-2 gap-6</code>).
                </ApiParameter>
                <ApiParameter Name="ListClass" Type="string?" Default="null">
                    Extra Tailwind classes applied to the list container. Merged on top of the default
                    <code>flex flex-col gap-2</code> via TailwindMerge — supply only the classes you want
                    to override (e.g. <code>gap-4</code> or <code>gap-0 divide-y</code> for a divider list).
                </ApiParameter>
                <ApiParameter Name="ShowToolbar" Type="bool" Default="true">
                    Whether to show the toolbar with search, sort, and (when applicable) layout-toggle controls.
                </ApiParameter>
                <ApiParameter Name="ShowPagination" Type="bool" Default="true">
                    Whether to show pagination controls (hidden when EnableInfiniteScroll is true).
                </ApiParameter>
                <ApiParameter Name="IsLoading" Type="bool" Default="false">
                    Whether the view is in a loading state.
                </ApiParameter>
                <ApiParameter Name="InitialPageSize" Type="int" Default="5">
                    Initial page size (also the batch size in infinite scroll mode).
                </ApiParameter>
                <ApiParameter Name="PageSizes" Type="int[]" Default="[5, 10, 20, 50, 100]">
                    Available page size options shown in the pagination size selector.
                </ApiParameter>
                <ApiParameter Name="EnableInfiniteScroll" Type="bool" Default="false">
                    Replaces pagination with progressive item loading. Works for both list and grid.
                </ApiParameter>
                <ApiParameter Name="ShowLoadMoreButton" Type="bool" Default="false">
                    Shows an explicit "Load more" button when EnableInfiniteScroll is true.
                </ApiParameter>
                <ApiParameter Name="ScrollHeight" Type="string?" Default="null">
                    CSS height for the scroll container in auto-scroll mode (e.g. "400px", "60vh").
                    When null, no inline height is set and the container inherits from its parent.
                </ApiParameter>
                <ApiParameter Name="EmptyTemplate" Type="RenderFragment?" Default="null">
                    Custom template for the empty state.
                </ApiParameter>
                <ApiParameter Name="LoadingTemplate" Type="RenderFragment?" Default="null">
                    Custom template for the loading state.
                </ApiParameter>
                <ApiParameter Name="OnSort" Type="EventCallback&lt;(string, SortDirection)&gt;">
                    Invoked when sorting changes.
                </ApiParameter>
                <ApiParameter Name="OnFilter" Type="EventCallback&lt;string?&gt;">
                    Invoked when the global search value changes.
                </ApiParameter>
            </ApiReference>

            <ApiReference ComponentName="DataViewField">
                <ApiParameter Name="Header" Type="string">
                    Display label used in the sort field selector.
                </ApiParameter>
                <ApiParameter Name="Property" Type="Func&lt;TItem, TValue&gt;">
                    Expression to get the field value from a data item.
                </ApiParameter>
                <ApiParameter Name="Sortable" Type="bool" Default="false">
                    Whether items can be sorted by this field.
                </ApiParameter>
                <ApiParameter Name="Filterable" Type="bool" Default="false">
                    Whether this field participates in global search filtering.
                </ApiParameter>
            </ApiReference>

            <ApiReference ComponentName="DataViewTemplate">
                <ApiParameter Name="Layout" Type="DataViewLayout" Default="List">
                    The layout mode this template applies to. Use DataViewLayout.List for the list
                    template and DataViewLayout.Grid for the grid template. Place two instances (one
                    per layout) inside the Fields fragment to enable the layout-toggle buttons.
                </ApiParameter>
                <ApiParameter Name="ChildContent" Type="RenderFragment&lt;TItem&gt;">
                    The render fragment used to display each item. The context parameter is the data item.
                </ApiParameter>
            </ApiReference>
        </div>
    </section>
</div>

@code {
    private List<Person> people = new();
    private List<Person> emptyPeople = new();
    private List<Product> products = new();
    private bool isLoading;

    protected override void OnInitialized()
    {
        people = MockDataService.GeneratePersons(500);
        products = MockDataService.GenerateProducts(60);
    }

    private static string GetInitials(string name)
    {
        var parts = name.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        return parts.Length >= 2
            ? $"{parts[0][0]}{parts[^1][0]}"
            : name.Length > 0 ? name[0].ToString() : "?";
    }
}
